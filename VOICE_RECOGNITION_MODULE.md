# ğŸ™ï¸ ChatBuff è¯­éŸ³è¯†åˆ«æ¨¡å—æ–‡æ¡£

## æ¦‚è¿°

ChatBuff åç«¯è¯­éŸ³è¯†åˆ«æ¨¡å—å®ç°äº†å®Œæ•´çš„å®æ—¶å¯¹è¯æ•æ‰å’Œæ™ºèƒ½è¾…åŠ©åŠŸèƒ½ï¼ŒåŒ…æ‹¬ï¼š

- **å®æ—¶è¯­éŸ³è½¬æ–‡å­—** - æ”¯æŒåŒäººå¯¹è¯æ•æ‰
- **LLM æ™ºèƒ½å»ºè®®** - æ ¹æ®å¯¹è¯å†…å®¹ç”Ÿæˆå¤šç§ç±»å‹å»ºè®®
- **æ–°é—»æ•°æ®é›†æˆ** - è·å–ç›¸å…³è¯é¢˜æ–°é—»ä½œä¸ºå¯¹è¯ç´ æ
- **åè¨€è­¦å¥å¢å¼º** - 30æ¡é«˜è´¨é‡åè¨€ç”¨äºæå‡å¯¹è¯æ·±åº¦

---

## æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Frontend (React)                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ConversationHistâ”‚  â”‚   MindMap   â”‚  â”‚  Suggestions + News Panel  â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚                    â”‚       AudioVisualizer Component      â”‚          â”‚
â”‚                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚          â”‚
â”‚                    â”‚  â”‚ WebSocket / HTTP API é€šä¿¡      â”‚  â”‚          â”‚
â”‚                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚          â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Backend (FastAPI)                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                     WebSocket Manager                          â”‚  â”‚
â”‚  â”‚  â€¢ å®æ—¶åŒå‘é€šä¿¡  â€¢ å¤šå®¢æˆ·ç«¯æ”¯æŒ  â€¢ å¿ƒè·³ä¿æ´»                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   Speech    â”‚  â”‚     LLM     â”‚  â”‚     RAG     â”‚  â”‚    News     â”‚ â”‚
â”‚  â”‚  Service    â”‚  â”‚   Service   â”‚  â”‚   Service   â”‚  â”‚   Service   â”‚ â”‚
â”‚  â”‚  (Whisper)  â”‚  â”‚  (DeepSeek) â”‚  â”‚  (ChromaDB) â”‚  â”‚  (NewsAPI)  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚         â”‚                â”‚                â”‚                â”‚         â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                 â”‚                                    â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚                    â”‚  ConversationAssistant â”‚                        â”‚
â”‚                    â”‚  â€¢ æœåŠ¡åè°ƒå™¨          â”‚                        â”‚
â”‚                    â”‚  â€¢ ä¸Šä¸‹æ–‡ç®¡ç†          â”‚                        â”‚
â”‚                    â”‚  â€¢ å»ºè®®ç”Ÿæˆ            â”‚                        â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æ ¸å¿ƒæ¨¡å—

### 1. è¯­éŸ³è¯†åˆ«æœåŠ¡ (`app/core/speech.py`)

| ç±» | åŠŸèƒ½ |
|---|---|
| `TranscriptSegment` | è½¬å½•ç‰‡æ®µæ¨¡å‹ï¼ˆæ–‡æœ¬ã€è¯´è¯äººã€ç½®ä¿¡åº¦ã€æ—¶é—´æˆ³ï¼‰ |
| `ConversationContext` | å¯¹è¯ä¸Šä¸‹æ–‡ç®¡ç†ï¼ˆ50æ®µå†å²çª—å£ï¼‰ |
| `SpeechRecognitionService` | è¯­éŸ³è¯†åˆ«æœåŠ¡ï¼ˆWhisper æˆ–æ¨¡æ‹Ÿæ¨¡å¼ï¼‰ |

**ç‰¹æ€§ï¼š**
- æ”¯æŒ `faster-whisper` æœ¬åœ°æ¨¡å‹ï¼ˆå¦‚å·²å®‰è£…ï¼‰
- æ¨¡æ‹Ÿæ¨¡å¼ä½œä¸ºåå¤‡ï¼ˆæ— éœ€ GPUï¼‰
- åŸºäºéŸ³é‡çš„è¯´è¯äººæ£€æµ‹ï¼ˆuser vs otherï¼‰
- 16kHz é‡‡æ ·ç‡ä¼˜åŒ–

### 2. æ–°é—»æœåŠ¡ (`app/core/news.py`)

| ç±» | åŠŸèƒ½ |
|---|---|
| `NewsItem` | æ–°é—»æ¡ç›®æ¨¡å‹ |
| `NewsService` | æ–°é—»è·å–ä¸ç¼“å­˜æœåŠ¡ |

**ç‰¹æ€§ï¼š**
- å¯é€‰ NewsAPI.org é›†æˆ
- 30åˆ†é’Ÿæ™ºèƒ½ç¼“å­˜
- å…³é”®è¯æå–åŒ¹é…
- å¤šåˆ†ç±»æ”¯æŒï¼ˆtechnology, business, sports, etc.ï¼‰

### 3. å¯¹è¯åŠ©æ‰‹ (`app/core/assistant.py`)

| ç±» | åŠŸèƒ½ |
|---|---|
| `ConversationSuggestion` | å»ºè®®æ¨¡å‹ |
| `AssistantResponse` | å®Œæ•´å“åº”æ¨¡å‹ |
| `ConversationAssistant` | æ ¸å¿ƒåè°ƒæœåŠ¡ |

**å»ºè®®ç±»å‹ï¼š**
| ç±»å‹ | æè¿° |
|------|------|
| `quote` | ç›¸å…³åè¨€è­¦å¥ï¼ˆæ¥è‡ª RAGï¼‰ |
| `insight` | æ·±åº¦æ´å¯Ÿï¼ˆLLM ç”Ÿæˆï¼‰ |
| `humor` | å¹½é»˜å»ºè®® |
| `question` | è¿½é—®é—®é¢˜ |
| `empathy` | å…±æƒ…å›åº” |

### 4. WebSocket ç®¡ç† (`app/core/websocket.py`)

| ç±» | åŠŸèƒ½ |
|---|---|
| `ClientSession` | å®¢æˆ·ç«¯ä¼šè¯ç®¡ç† |
| `ConnectionManager` | WebSocket è¿æ¥ç®¡ç†å™¨ |

**ç‰¹æ€§ï¼š**
- å¤šå®¢æˆ·ç«¯å¹¶å‘æ”¯æŒ
- åˆ†ç»„å¹¿æ’­åŠŸèƒ½
- å¿ƒè·³æ£€æµ‹æœºåˆ¶
- è‡ªåŠ¨é‡è¿å¤„ç†

---

## API ç«¯ç‚¹

### REST API

| ç«¯ç‚¹ | æ–¹æ³• | åŠŸèƒ½ |
|------|------|------|
| `/` | GET | API çŠ¶æ€ä¿¡æ¯ |
| `/health` | GET | å¥åº·æ£€æŸ¥ |
| `/api/suggestion` | POST | è·å–å›å¤å»ºè®® |
| `/api/quotes` | GET | è·å–åè¨€ç»Ÿè®¡ |
| `/api/transcribe` | POST | éŸ³é¢‘è½¬æ–‡å­— |
| `/api/assistant/process` | POST | å¤„ç†æ–‡æœ¬è¾“å…¥ |
| `/api/assistant/history` | GET | è·å–å¯¹è¯å†å² |
| `/api/assistant/reset` | POST | é‡ç½®ä¼šè¯ |
| `/api/news` | POST | è·å–åˆ†ç±»æ–°é—» |
| `/api/news/relevant` | GET | è·å–ç›¸å…³æ–°é—» |
| `/api/ws/status` | GET | WebSocket çŠ¶æ€ |

### WebSocket

| ç«¯ç‚¹ | åŠŸèƒ½ |
|------|------|
| `/ws/{client_id}` | å®æ—¶åŒå‘é€šä¿¡ |

**æ¶ˆæ¯æ ¼å¼ï¼š**
```json
// å‘é€éŸ³é¢‘
{
  "type": "audio",
  "audio_data": "<base64>",
  "sample_rate": 16000
}

// æ¥æ”¶è½¬å½•
{
  "type": "transcript",
  "data": {
    "text": "å¯¹è¯å†…å®¹",
    "speaker": "user",
    "confidence": 0.95
  }
}

// æ¥æ”¶å»ºè®®
{
  "type": "suggestions",
  "data": {
    "suggestions": [...],
    "related_news": [...]
  }
}
```

---

## åè¨€è­¦å¥åº“

å·²æ‰©å±•è‡³ **30 æ¡é«˜è´¨é‡åè¨€**ï¼Œæ¶µç›–ï¼š

| ç±»åˆ« | ç¤ºä¾‹ä½œè€… |
|------|---------|
| åŠ±å¿— | ä¹”å¸ƒæ–¯ã€ä¸˜å‰å°”ã€å°¼é‡‡ |
| å“²å­¦ | è‹æ ¼æ‹‰åº•ã€ç¬›å¡å°”ã€åº·å¾· |
| å›½å­¦ | å­”å­ã€è€å­ã€å­Ÿå­ã€åº„å­ |
| æ™ºæ…§ | è¾¾èŠ¬å¥‡ã€çˆ±å› æ–¯å¦ã€åŸ¹æ ¹ |
| å¹½é»˜ | é©¬å…‹Â·åæ¸©ã€è§ä¼¯çº³ |

---

## ä½¿ç”¨ç¤ºä¾‹

### 1. å¤„ç†æ–‡æœ¬è¾“å…¥

```bash
curl -X POST http://localhost:8000/api/assistant/process \
  -H "Content-Type: application/json" \
  -d '{"text": "ä»Šå¤©å·¥ä½œå‹åŠ›å¥½å¤§ï¼ŒçœŸçš„å¾ˆç´¯"}'
```

**å“åº”ï¼š**
```json
{
  "transcript": {
    "text": "ä»Šå¤©å·¥ä½œå‹åŠ›å¥½å¤§ï¼ŒçœŸçš„å¾ˆç´¯",
    "speaker": "other",
    "confidence": 1.0
  },
  "suggestions": [
    {
      "type": "quote",
      "content": "ä½ å¥½å‰å®³ï¼Œå¾ˆç‰¹åˆ«çš„äººã€‚",
      "source": "ã€Šå†ˆä»ã€‹- ä¸¹Â·å€­å°”å¤«",
      "confidence": 0.85
    },
    {
      "type": "insight",
      "content": "è‹æ ¼æ‹‰åº•è¯´è¿‡ï¼šäººç”Ÿè‹¦çŸ­...",
      "source": "AI å»ºè®®",
      "confidence": 0.8
    }
  ],
  "related_news": [...]
}
```

### 2. WebSocket å®æ—¶é€šä¿¡

```javascript
const ws = new WebSocket('ws://localhost:8000/ws/my-client-id');

ws.onopen = () => console.log('å·²è¿æ¥');

ws.onmessage = (event) => {
  const data = JSON.parse(event.data);
  if (data.type === 'transcript') {
    console.log('è½¬å½•:', data.data.text);
  }
  if (data.type === 'suggestions') {
    console.log('å»ºè®®:', data.data.suggestions);
  }
};

// å‘é€éŸ³é¢‘
ws.send(JSON.stringify({
  type: 'audio',
  audio_data: base64AudioData,
  sample_rate: 16000
}));
```

---

## å¯åŠ¨æŒ‡å—

### åç«¯

```bash
# 1. å®‰è£…ä¾èµ–
pip install -r requirements.txt

# 2. åˆå§‹åŒ–åè¨€åº“
python scripts/init_db.py

# 3. å¯åŠ¨æœåŠ¡
python -m uvicorn app.main:app --host 0.0.0.0 --port 8000
```

### å‰ç«¯

```bash
cd frontend
npm install
npm run dev
```

---

## ç¯å¢ƒå˜é‡

åœ¨ `.env` æ–‡ä»¶ä¸­é…ç½®ï¼š

```env
DEEPSEEK_API_KEY=your_api_key
NEWS_API_KEY=your_newsapi_key  # å¯é€‰
```

---

## çŠ¶æ€

âœ… **å·²å®ŒæˆåŠŸèƒ½ï¼š**
- è¯­éŸ³è¯†åˆ«æœåŠ¡ï¼ˆæ¨¡æ‹Ÿæ¨¡å¼ï¼‰
- LLM é›†æˆï¼ˆDeepSeekï¼‰
- RAG åè¨€æ£€ç´¢ï¼ˆChromaDBï¼‰
- æ–°é—»æœåŠ¡ï¼ˆæ¨¡æ‹Ÿæ•°æ®ï¼‰
- WebSocket å®æ—¶é€šä¿¡
- ä¸‰æ å¸ƒå±€å‰ç«¯
- å®æ—¶å»ºè®®å±•ç¤º

âš ï¸ **éœ€è¦é¢å¤–é…ç½®ï¼š**
- `faster-whisper` GPU åŠ é€Ÿï¼ˆå¯é€‰ï¼‰
- NewsAPI.org API Keyï¼ˆå¯é€‰ï¼Œæœ‰æ¨¡æ‹Ÿæ•°æ®åå¤‡ï¼‰

---

*æœ€åæ›´æ–°ï¼š2025-12-13*
